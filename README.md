link to gist https://gist.github.com/ken-elsheezy/64b9ce6d05e3fa32e2416850e8abf4b5.js

Introduction
----------------
This is a step by step walkthrough on how to automate your deployment process 
with Travis to a remote server like AWS/Digital Ocean e.t.c using SSH. 
For Travis to successfully authenticate after a successful build and deploy_key, 
you would need to generate unique SSH keys on the sever that you can download and
encrypt with Travis cli.

Pre-requisites
-----------------
1. A Server running a linux os which you can normally authenticate into
2. A  remote github repostiory
3. A local project you want to deploy_key
4. Ruby installed on your local computer, to enable you use gem to 
	download the Travis CLI (This is still explained below)
	



Step 1: SSH into your droplet/aws-instence

Step 2: Cd into the ssh directory /home/ubuntu/.ssh
      
	  [terminal$] cd ~/.ssh
      When you ssh into this directory, it contains by default an ***authorized_key*** file

	  
Step 3: generate the private key you want to use for SSH
      
	  //note: you can use any file name
	  [terminal /.ssh $] ssh-keygen -t rsa -b 4096 -C "TravisCIDeployKey"     
      
	  An id_rsa and id_rsa.pub file would be created in the directory

      
Step 4: The file is generated, click [enter] to skip providing a password or pass-phrase 


Step 5: add the new SSH key to the authorized_keys file, so that we can use the key to authenticate
      
	  [terminal /.ssh $] cat id_rsa.pub >> authorized_keys   

      //the command would append the contents of id_rsa.pub to the authorized_keys files

      
Step 6:  Add deploy_key to your git ignore file, so that it dosent get commited to version control eg github


Step 7: Copy the id_rsa file to your local computer and project root repository
        with secure copy, file zilla or with whatever other method you prefer.

      example:
      [Local computer $]scp root@138.68.163.126:/root/.ssh/id_rsa ./deploy_key

      
Step 8: Now you should have the deploy_key in the root directory of your Local project.
        So we test/check if we can login with this new key via ssh

        
      [terminal $] ssh -i ./deploy_key user@ip.address  
      
      //you should be successfully authenticated
      
Step 9: Next we need to encrypt the deploy_key, and to do that we have to install 
        Travis CLI. But to download Travis Cli you must first 
        download ruby to use gem. 

        
        - windows: (dependency https://rubyinstaller.org/downloads for windows)
        - mac:    [terminal $] brew install ruby
        - ubuntu: [terminal $] apt install ruby ruby-dev
        
        - So first we install Ruby with the executable we downloaded above
        Then we use gems to install travis
        [terminal $] gem install travis

		
Step 10: Log into travis first as authentication is required
        
		[terminal $] winpty ruby `which travis` login --com  //for windows users using git bash
        [terminal $] travis login --com  //for other users

Step 11: Perform the Encryption
		
		[terminal $] touch .travis.yml && travis encrypt-file ./deploy_key --add
      
		//this would create a deploy_key.enc file which you can successfully commit to github
		//also ensure you do not commit deploy_key by adding it to git ignore
      
	  
Step 12: Add this rule to your .travis.yml file exactly below the RSA step generated by the encryption
            
        - ssh-add ./deploy_key              //add this line
            
		Example:
			before_install:
			- openssl aes-256-cbc -K $encrypted_77965d5bdd4d_key -iv $encrypted_77965d5bdd4d_iv
			  -in deploy_key.enc -out ./deploy_key -d
			- ssh-add ./deploy_key   
            
		//at this point do not forget to commit the deploy_key and .travis.yml file      
      
	  
Step 13: Add more rules to perform authentication


		|-----------------------------------------------------------------------------------| 
			.travis.yml (node is just for illustration, change as required)
		|-----------------------------------------------------------------------------------| 
		language: node_js

		node_js:
		- node

		env:
		- SERVER_IP_ADDRESS=127.12.13.9

		before_install:
		- eval "$(ssh-agent -s)"
		- chmod 600 ./deploy_key
		- echo -e "Host $SERVER_IP_ADDRESS\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
		- openssl aes-256-cbc -K $encrypted_77965d5bdd4d_key -iv $encrypted_77965d5bdd4d_iv
		   -in deploy_key.enc -out ./deploy_key -d
		- ssh-add ./deploy_key
		- ssh -i ./deploy_key ubuntu@127.12.13.9 pwd

		after_success:
		- echo "build complete cheers"      
		|-------------------------------------------------------------------------------------| 

		|-------------------------------------------------------------------------------------| 
		
		